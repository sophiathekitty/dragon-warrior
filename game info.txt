type:game,title:Dragon Warrior,name:Dragon,engine:rpg
║type:player═

level:1,
hp:15,mp:0,
strength:4,
agility:4,
attack:6,
defense:4,
xp:0,
gold:0,
keys:0═

weapon:Bamboo Pole,
shield:,
armor:,
ring:,
necklace:,
belt:═

map:throne,
x:2,
y:5




║type:item,item_type:weapon═

name:Bamboo Pole,
attack:2,
cost:10═

name:Club,
attack:4,
cost:60═

name:Copper Sword,
attack:10,
cost:180═

name:Hand Axe,
attack:15,
cost:560═

name:Broad Sword,
attack:20,
cost:1500═

name:Flame Sword,
attack:28,
cost:9800═

name:Erdrick's Sword,
attack:40


║type:item,item_type:armor═

name:Clothes,
defense:2,
cost:20═

name:Leather Armor,
defense:4,
cost:70═

name:Chain Mail,
defense:10,
cost:300═

name:Half Plate,
defense:16,
cost:1000═

name:Full Plate,
defense:24,
cost:3000═

name:Magic Armor,
defense:24,
cost:7700═

name:Erdrick's Armor,
defense:28


║type:item,item_type:shield═

name:Small Shield,
defense:4,
cost:90═

name:Large Shield,
defense:10,
cost:800═

name:Silver Shield,
defense:20,
cost:14800


║type:item,item_type:use═

name:Herb,
cost:24,
effect:herb═

name:Wings,
cost:70,
effect:return_home═

name:Torch,
cost:8,
effect:torch═

name:Fairy Water,
cost:38,
effect:avoid_encounters═

name:Light Orb═

name:Erdrick's Tablet,
effect:read_tablet═

name:Silver Harp,
effect:silver_harp═

name:Rain Staff═

name:Sunstone═

name:Gwaelin's Love,
effect:distance_from_castle═

name:Erdrick's Token═

name:Rainbow Drop


║type:item,item_type:necklace═

name:Dragon's Scale,
defense:2,
cost:20═

name:Cursed Necklace,
cost:1200


║type:item,item_type:ring═

name:Fighter's Ring,
attack:2,
cost:15


║type:item,item_type:belt═

name:Cursed Belt,cost:180


║type:spells,
name:magic,
level:player.level,
cost:player.mp═

name:Heal,
level:3,
cost:3,
effect:cast_heal═

name:Hurt,
level:4,
cost:2,
combat:true,
effect:cast_hurt═

name:Sleep,
level:7,
cost:2,
combat:true,
effect:cast_sleep═

name:Radiant,
level:9,
cost:2,
combat:false,
effect:cast_radiant═

name:StopSpell,
level:10,
cost:2,
combat:true,
effect:cast_stop═

name:Outside,
level:12,
cost:6,
combat:false,
effect:cast_outside═

name:Return,
level:13,
cost:8,
combat:false,
effect:return_home═

name:Repel,
level:15,
cost:2,
combat:false,
effect:avoid_encounters═

name:HealMore,
level:17,
cost:8,
effect:cast_healmore═

name:HurtMore,
level:19,
cost:5,
combat:true,
effect:cast_hurtmore




║type:logic


═action:DamagePlayer;
    sub:player.hp=ints.damage;
    if:player.hp>0;
        exit;
    endif;
    go:outworld,47,45;
    setto:player.hp=playerMax.hp;
    setto:player.mp=playerMax.mp;
    setto:int.gold=player.gold;
    div:ints.gold=4;
    sub:player.gold=ints.gold;
    if:player.gold<0;
        set:player.gold=0;
    endif;
    set:encounter.over=true;
    say:Thou hast nearly perished. But thy adventure must go on. ints.gold of thy gold hast been lost to the Dragonlord's minions.;

═action:CalculatePlayerStats;
    setto:player.strength=playerMax.strength;
    setto:player.agility=playerMax.agility;
    setto:player.attack=player.strength;
    add:player.attack=gear.attack;
    setto:player.defense=player.agility;
    add:player.defense=gear.defense;


═action:PlayerStep;
    sub:ints.fairySteps=1;
    sub:ints.radiantSteps=1;
    if:ints.fairySteps<0;
        set:ints.fairySteps=0;
    endif;
    if:ints.radiantSteps=0;
        set:map.darkRadius=1;
    endif;
    if:ints.radiantSteps<0;
        set:ints.radiantSteps=0;
    endif;
    if:ints.radiantSteps=60;
        set:map.darkRadius=2;
    endif;
    if:ints.radiantSteps=120;
        set:map.darkRadius=3;
    endif;
    if:map.OnToxicTile=true;
        setto:ints.damage=map.ToxicLevel;
        ifnot:playerGear.armor=Erdrick's Armor;
            run:DamagePlayer;
    endif;
    if:playerGear.armor=Erdrick's Armor;
        add:player.hp=1;
    endif;
    if:playerGear.armor=Magic Armor;
        add:player.hp=1;
    endif;
    if:player.hp>playerMax.hp;
        setto:player.hp=playerMax.hp;
    endif;
    if:map.name=outworld;
        set:map.darkRadius=1;
        setto:ints.east=player.x;
        sub:ints.east=46;
        set:ints.west=46;
        sub:ints.west=player.x;
        setto:ints.south=player.y;
        sub:ints.south=46;
        set:ints.north=46;
        sub:ints.north=player.y;
    endif;
    run:RandomEncounter;

═action:RandomEncounter;
    if:ints.fairySteps>0;
        exit;
    endif;
    if:map.hasEncounters=false;
        exit;
    endif;
    if:map.OnDangerTile=true;
        set:ints.encounterThreshold=30;
    else;
        set:ints.encounterThreshold=15;
    endif;
    rand:ints.encounterCheck=0,100;
    if:ints.encounterCheck<ints.encounterThreshold;
        encounter:map.encounter;

═action:StartEncounter;
    rand:ints.run=0,255;
    mul:ints.run=player.agility;
    rand:ints.block=0,255;
    mul:ints.block=enemy.agility;
    if:ints.run>ints.block;
        set:encounter.playerTurn=true;
        say:A ENEMYNAME draws near!;
    else;
        set:encounter.playerTurn=false;
        say:A ENEMYNAME hast surprised thou.;

═action:WinEncounter;
    add:player.xp=enemy.exp;
    add:player.gold=enemy.gold;
    set:encounter.over=true;
    if:playerMax.xp=0;
        set:playerMax.xp=7;
    endif;
    if:player.xp<playerMax.xp;
        say:Thou hast done well in defeating the ENEMYNAME. Thy Experience increases by enemy.exp. Thy gold increases by enemy.gold.;
    endif;
    add:player.level=1;
    if:player.level>30;
        player.level=30;
        exit;
    endif;
    if:player.level=2;
        set:playerMax.xp=23;
        add:playerMax.hp=7;
        add:playerMax.strength=1;
        run:CalculatePlayerStats;
        say:Thou hast done well in defeating the ENEMYNAME. Thy Experience increases by enemy.exp. Thy gold increases by enemy.gold. Courage and wit have served thee well. Thou hast been promoted to the next level. Thy power increases by 1. Thy Maximum Hit Points increase by 7.;
    endif;
    if:player.level=3;
        set:playerMax.xp=47;
        add:playerMax.strength=2;
        add:playerMax.agility=2;
        add:playerMax.hp=2;
        add:playerMax.mp=7;
        run:CalculatePlayerStats;
        say:Thou hast done well in defeating the ENEMYNAME. Thy Experience increases by enemy.exp. Thy gold increases by enemy.gold. Courage and wit have served thee well. Thou hast been promoted to the next level. Thy power increases by 2. Thy Response Speed increases by 2. Thy Maximum Hit Points increase by 2. Thy Maximum Magic Points increase by 6. Thou hast learned a new spell.;
    endif;
    if:player.level>3;
        setto:ints.xpIncrease=playerMax.xp;
        div:ints.xpIncrease=3;
        add:playerMax.xp=ints.xpIncrease;        
        rand:ints.hpIncrease=2,15;
        add:playerMax.hp=ints.hpIncrease;
        rand:ints.mpIncrease=2,20;
        add:playerMax.mp=ints.mpIncrease;
        rand:ints.agilityIncrease=2,8;
        add:playerMax.agility=ints.agilityIncrease;
        rand:ints.strengthIncrease=2,10;
        add:playerMax.strength=ints.strengthIncrease;
        run:CalculatePlayerStats;
        say:Thou hast done well in defeating the ENEMYNAME. Thy Experience increases by enemy.exp. Thy gold increases by enemy.gold. Courage and wit have served thee well. Thou hast been promoted to the next level. Thy strength hast increased by ints.strengthIncrease and thy agility hast increased by ints.agilityIncrease. Thy hp hast increased by ints.hpIncrease and thy mp hast increased by ints.mpIncrease. Maybe thou hast even learned a new spell? i'm kinda just doing random stat increases at this point... maybe i'll change this at some point.;

═action:return_home;
    if:map.name=outworld;
        go:outworld,47,45;

═action:torch;
    set:map.darkRadius=2;
    take:Torch;

═action:avoid_encounters;
    set:ints.fairySteps=128;

═action:herb;
    rand:ints.restore=20,30;
    add:player.hp=ints.restore;
    if:player.hp>playerMax.hp;
        setto:player.hp=playerMax.hp;

═action:silver_harp;
    encounter:Slime,Red Slime,Drakee,Ghost,Magician,Scorpion;


═action:distance_from_castle;
    if:ints.north>0;if:ints.west>0;
        say:Thou art ints.north North by ints.west West of the castle my love.;
    endif;
    if:ints.north>0;if:ints.east>0;
        say:Thou art ints.north North by ints.east East of the castle my love.;
    endif;
    if:ints.north>0;if:ints.east=0;
        say:Thou art ints.north North of the castle my love.;
    endif;
    if:ints.south>0;if:ints.west>0;
        say:Thou art ints.south South by ints.west West of the castle my love.;
    endif;
    if:ints.south>0;if:ints.east>0;
        say:Thou art ints.south South by ints.east East of the castle my love.;
    endif;
    if:ints.south>0;if:ints.east=0;
        say:Thou art ints.south South of the castle my love.;
    endif;
    

═action:read_tablet;
    say:this should be some sort of hint i guess but... woops... i haven't looked up what it should be at this point.;

═action:cast_heal;
    rand:ints.restore=25,30;
    add:player.hp=ints.restore;
    if:player.hp>playerMax.hp;
        setto:player.hp=playerMax.hp;
    endif;
    say:Thou hast restore ints.restore hp.;

═action:cast_hurt;
    rand:ints.spellChance=1,16;
    if:enemy.hurtResist>ints.spellChance;
        say:Thou casts Hurt but fail to hit thou target.;
    endif;
    rand:ints.damage=8,12;
    run:DamageEnemy;

═action:cast_sleep;
    rand:ints.spellChance=1,16;
    if:enemy.sleepResist>ints.spellChance;
        say:Thou hast cast Sleep but enemy.name resists.;
    endif;
    set:enemy.status=sleep;
    say:Thou hast put enemy.name to sleep.;

═action:cast_radiant;
    set:ints.radiantSteps=200;
    set:map.darkRadius=4;
    say:Thou hast cast radiant.;
═action:cast_stop;
    rand:ints.spellChance=1,16;
    if:enemy.stopResist>ints.spellChance;
        say:Thou hast cast Stop but it had no effect.;
═action:cast_outside;
    if:map.name=outworld;
        say:Thoust art already outside.;
    endif;
    go:map.Exit;

═action:cast_healmore;
    rand:ints.restore=25,30;
    add:player.hp=ints.restore;
    if:player.hp>playerMax.hp;
        setto:player.hp=playerMax.hp;
═action:cast_hurtmore;
    rand:ints.spellChance=1,16;
    if:enemy.hurtResist>ints.spellChance;
        say:Thou casts Hurt but fail to hit thou target.;
    endif;
    rand:ints.damage=58,65;
    run:DamageEnemy;

═action:PlayerAttack;
    setto:ints.damage=player.attack;
    setto:ints.defense=enemy.agility;
    div:ints.defense=2;
    sub:ints.damage=ints.defense;
    div:ints.damage=4;
    run:DamageEnemy;

═action:PlayerRun;
    rand:ints.run=0,255;
    mul:ints.run=player.agility;
    rand:ints.block=0,255;
    mul:ints.block=enemy.agility;
    if:ints.run>ints.block;
        set:encounter.over=true;
        say:Thou hast ran away.;
    else;
        say:ENEMYNAME hast blocked thy attempt to flee.;

═action:DamageEnemy;
    sub:enemy.hp=ints.damage;
    if:enemy.hp>0;
        say:ENEMYNAME takes ints.damage damage.;
    else;
        run:WinEncounter;

═action:attack;
    if:player.defense>enemy.strength;
        setto:ints.damage=enemy.strength;
        add:ints.damage=4;
        div:ints.damage=6;
    else;
        setto:ints.damage=enemy.strength;
        setto:ints.defense=player.defense;
        div:ints.defense=2;
        sub:ints.damage=ints.defense;
        div:ints.damage=4;
    endif;
    run:DamagePlayer;
    say:ENEMYNAME attacks! Thou hast lost ints.damage hp.;


═action:hurt;
    rand:ints.damage=3,5;
    if:playerGear.armor=Magic Armor;
        div:ints.damage=3;
    endif;
    if:playerGear.armor=Erdrick's Armor;
        div:ints.damage=3;
    endif;
    run:DamagePlayer;
    say:ENEMYNAME cast hurt! Thou hast lost ints.damage hp.;

═action:stop;
    rand:ints.stopChance=0,100;
    if:ints.stopChance>50;
        set:player.status=stop;
        say:ENEMYNAME casts Stop. Thy magic hast been stopped.;
    endif;
    say:ENEMYNAME casts Stop. Thy magic remains unstopped.;

═action:sleep;
    rand:ints.stopChance=0,100;
    if:ints.stopChance>50;
        set:player.status=sleep;
        say:ENEMYNAME casts Sleep. Thou hast fallen asleep.;
    endif;
    say:ENEMYNAME casts Sleep. Thou hast resisted.

═action:hurtmore;
    rand:ints.damage=30,45;
    if:playerGear.armor=Magic Armor;
        div:ints.damage=3;
    endif;
    if:playerGear.armor=Erdrick's Armor;
        div:ints.damage=3;
    endif;
    run:DamagePlayer;
    say:ENEMYNAME cast hurtmore! Thou hast lost ints.damage hp.;

═action:breath;
    rand:ints.damage=16,23;
    if:playerGear.armor=Magic Armor;
        div:ints.damage=3;
    endif;
    if:playerGear.armor=Erdrick's Armor;
        div:ints.damage=3;
    endif;
    run:DamagePlayer;
    say:ENEMYNAME hast horrid breath! Thou hast lost ints.damage hp.;

═action:strongbreath;
    rand:ints.damage=65,72;
    if:playerGear.armor=Magic Armor;
        div:ints.damage=3;
    endif;
    if:playerGear.armor=Erdrick's Armor;
        div:ints.damage=3;
    endif;
    run:DamagePlayer;
    say:ENEMYNAME hast breath of fire! Thou hast lost ints.damage hp.;

═action:run;
    rand:ints.run=0,100;
    if:ints.run<25;
        set:encounter.over=true;
        say:ENEMYNAME hast ran way.;
    else;
        say:Thou hast blocked ENEMYNAME attempt to flee.;